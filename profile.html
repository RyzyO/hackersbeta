<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <title>Hackers Cup | Profile</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:ital,wght@1,700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Tailwind Config (copied from index.html) -->
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ['Inter', 'sans-serif'],
            },
            colors: {
              hackers: {
                dark: '#0f172a',
                navy: '#1e3a5f',
                sky: '#0ea5e9',
                light: '#38bdf8',
                gold: '#f59e0b',
                surface: '#1e293b',
              }
            },
            animation: {
              'fade-in': 'fadeIn 0.5s ease-in-out',
              'slide-up': 'slideUp 0.6s ease-out',
              'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
            },
            keyframes: {
              fadeIn: {
                '0%': { opacity: '0' },
                '100%': { opacity: '1' },
              },
              slideUp: {
                '0%': { transform: 'translateY(20px)', opacity: '0' },
                '100%': { transform: 'translateY(0)', opacity: '1' },
              }
            }
          }
        }
      }
    </script>

    <link rel="manifest" href="site.webmanifest">
    <style>
      /* Custom Scrollbar */
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }
      ::-webkit-scrollbar-track {
        background: #0f172a;
      }
      ::-webkit-scrollbar-thumb {
        background: #334155;
        border-radius: 4px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #475569;
      }
      /* Glassmorphism Utilities */
      .glass {
        background: rgba(30, 41, 59, 0.7);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }
      .glass-card {
        background: rgba(30, 41, 59, 0.6);
        backdrop-filter: blur(16px);
        -webkit-backdrop-filter: blur(16px);
        border: 1px solid rgba(255, 255, 255, 0.08);
        transition: all 0.3s ease;
      }
      .glass-card:hover {
        background: rgba(30, 41, 59, 0.8);
        border-color: rgba(14, 165, 233, 0.3);
        transform: translateY(-4px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
      }
      /* Video Container Styles */
      .video-thumb {
        position: relative;
        overflow: hidden;
        border-radius: 16px;
        cursor: pointer;
      }
      .video-thumb::after {
        content: '';
        position: absolute;
        inset: 0;
        background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, transparent 50%);
        opacity: 0;
        transition: opacity 0.3s ease;
      }
      .video-thumb:hover::after {
        opacity: 1;
      }
      .video-thumb video {
        transition: transform 0.5s ease;
      }
      .video-thumb:hover video {
        transform: scale(1.05);
      }
      .play-icon {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0.8);
        opacity: 0;
        transition: all 0.3s ease;
        z-index: 10;
      }
      .video-thumb:hover .play-icon {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }
      /* Countdown Styling */
      .countdown-box {
        background: linear-gradient(135deg, rgba(14, 165, 233, 0.15) 0%, rgba(15, 23, 42, 0.4) 100%);
        border: 1px solid rgba(56, 189, 248, 0.2);
      }
      .countdown-number {
        background: linear-gradient(135deg, #38bdf8 0%, #0ea5e9 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }
      /* Sponsor Animation */
      .sponsor-fade {
        transition: opacity 0.35s ease-in-out;
      }
      .sponsor-fade.is-fading {
        opacity: 0;
      }
      /* Bottom Nav */
      .bottom-nav {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: rgba(15, 23, 42, 0.95);
        backdrop-filter: blur(20px);
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        z-index: 50;
        padding-bottom: env(safe-area-inset-bottom);
      }
      /* Modal */
      .modal-backdrop {
        background: rgba(0, 0, 0, 0.9);
        backdrop-filter: blur(8px);
      }
      /* Hero Gradient */
      .hero-gradient {
        background: linear-gradient(135deg, #0f172a 0%, #1e3a5f 50%, #0f172a 100%);
      }
      /* Loading Spinner */
      .loader {
        border: 3px solid rgba(255, 255, 255, 0.1);
        border-top-color: #38bdf8;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        to { transform: rotate(360deg); }
      }
      /* Profile/Awards Custom (refactored) */
      .badge {
        display: inline-flex;
        align-items: center;
        gap: .5rem;
        background: #0ea5e9;
        color: #04263b;
        border-radius: 9999px;
        padding: .4rem .9rem;
        font-size: .85rem;
        margin: 2px;
        font-weight: 600;
        box-shadow: 0 6px 18px rgba(2,6,23,0.45);
        transition: transform .12s ease, box-shadow .12s ease;
      }
      .badge:hover { transform: translateY(-3px); box-shadow: 0 12px 28px rgba(2,6,23,0.55); }
      .badge i { opacity: .95; }
      .badge.total { background: linear-gradient(90deg,#f59e0b,#facc15); color: #0b1220; }
      .badge.consec { background: linear-gradient(90deg,#10b981,#059669); color: #04263b; }
      .badge--muted { background: rgba(255,255,255,0.03); color: #9aa6b2; box-shadow: none; font-weight: 500; border: 1px solid rgba(255,255,255,0.03); }

      /* Pill containers (centered, wrapped, consistent spacing) */
      .badges, #awardsList { display: flex; gap: .5rem; flex-wrap: wrap; justify-content: center; align-items: center; max-width: 100%; }
      .badges { margin-bottom: .75rem; }

      .events-list .year { background: rgba(255,255,255,0.03); padding: .35rem .6rem; border-radius: .5rem; color: #cfefff; font-weight: 700; }

      /* Honour cards grid: equal-width, symmetric layout */
      #honoursList { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem; }
      .honour-card { background: rgba(14, 25, 41, 0.55); border: 1px solid rgba(255,255,255,0.04); padding: .75rem; border-radius: .75rem; display: flex; gap: .75rem; align-items: flex-start; min-height: 100px; }
      .honour-card .meta { color: #94a3b8; font-size: .85rem; }
      .honour-card .title { font-weight: 700; margin-top: .25rem; }
      .awards-section { border-top: 1px solid rgba(255,255,255,0.02); padding-top: 1rem; margin-top: 1rem; }
      .no-data { color: #94a3b8; font-size: .95rem; }

      /* smooth-scroll highlight */
      #honoursList.highlight { outline: 3px solid rgba(56,189,248,0.12); box-shadow: 0 10px 40px rgba(2,6,23,0.5); transition: outline .2s ease; }
      @media (max-width: 640px) { #honoursList { grid-template-columns: 1fr; } }
      
    </style>
  </head>
  <body class="bg-hackers-dark text-white font-sans antialiased pb-24">
  <!-- Preloader -->
  <div id="preloader" class="fixed inset-0 z-[100] bg-golf-dark flex items-center justify-center transition-opacity duration-500">
    <div class="text-center">
      <div class="loader mx-auto mb-4"></div>
      <p class="text-gray-400 text-sm tracking-wider uppercase">Loading Hackers Cup...</p>
    </div>
  </div>

  <!-- Navigation -->
  <nav class="fixed top-0 w-full z-40 glass border-b border-white/10">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <!-- Logo -->
        <div class="flex-shrink-0 flex items-center gap-3">
          <div class="w-10 h-10 rounded-full flex items-center justify-center overflow-hidden bg-hackers-navy">
            <img src="assets/images/logo.png" alt="Hackers Cup Logo" class="w-8 h-8 object-contain">
          </div>
            <span class="font-bold text-xl tracking-tight hackers-cup-heading">HACKERS CUP 26</span>
        </div>
        
        <!-- Desktop Menu -->
        <div class="hidden md:flex items-center space-x-1">
          <a href="index.html" class="px-4 py-2 rounded-lg text-sm font-medium text-white bg-white/10 hover:bg-white/20 transition-colors">Home</a>
          <a href="register.html" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-300 hover:text-white hover:bg-white/10 transition-colors">Register</a>
          <a href="venue.html" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-300 hover:text-white hover:bg-white/10 transition-colors">Venue</a>
          <a href="payment.html" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-300 hover:text-white hover:bg-white/10 transition-colors">Payment</a>
          <a href="podcast.html" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-300 hover:text-white hover:bg-white/10 transition-colors">Podcast</a>
          <a href="schedule.html" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-300 hover:text-white hover:bg-white/10 transition-colors">Schedule</a>
          <a href="weather.html" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-300 hover:text-white hover:bg-white/10 transition-colors">Weather</a>
          <a href="score.html" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-300 hover:text-white hover:bg-white/10 transition-colors">Score</a>
          <a href="honour-roll.html" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-300 hover:text-white hover:bg-white/10 transition-colors">Honour Roll</a>
          <a href="notifications-center.html" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-300 hover:text-white hover:bg-white/10 transition-colors">Notifications</a>
        </div>
        
        <!-- Mobile Menu Button -->
        <div class="md:hidden">
          <button onclick="toggleMobileMenu()" class="p-2 rounded-lg text-gray-300 hover:text-white hover:bg-white/10">
            <i data-lucide="menu" class="w-6 h-6"></i>
          </button>
        </div>
      </div>
    </div>
    <!-- Mobile Menu -->
    <div id="mobile-menu" class="hidden md:hidden glass border-t border-white/10">
      <div class="px-4 pt-2 pb-3 space-y-1">
        <a href="index.html" class="block px-3 py-2 rounded-md text-base font-medium text-white bg-hackers-sky/30">Home</a>
        <a href="register.html" class="block px-3 py-2 rounded-md text-base font-medium text-gray-300 hover:text-white hover:bg-white/10">Register</a>
        <a href="venue.html" class="block px-3 py-2 rounded-md text-base font-medium text-gray-300 hover:text-white hover:bg-white/10">Venue</a>
        <a href="payment.html" class="block px-3 py-2 rounded-md text-base font-medium text-gray-300 hover:text-white hover:bg-white/10">Payment</a>
        <a href="podcast.html" class="block px-3 py-2 rounded-md text-base font-medium text-gray-300 hover:text-white hover:bg-white/10">Podcast</a>
        <a href="schedule.html" class="block px-3 py-2 rounded-md text-base font-medium text-gray-300 hover:text-white hover:bg-white/10">Schedule</a>
        <a href="weather.html" class="block px-3 py-2 rounded-md text-base font-medium text-gray-300 hover:text-white hover:bg-white/10">Weather</a>
        <a href="score.html" class="block px-3 py-2 rounded-md text-base font-medium text-gray-300 hover:text-white hover:bg-white/10">Score</a>
        <a href="honour-roll.html" class="block px-3 py-2 rounded-md text-base font-medium text-gray-300 hover:text-white hover:bg-white/10">Honour Roll</a>
        <a href="notifications-center.html" class="block px-3 py-2 rounded-md text-base font-medium text-gray-300 hover:text-white hover:bg-white/10">Notifications</a>
      </div>
    </div>
  </nav>

    <section class="relative pt-24 pb-12 md:pt-32 md:pb-16 overflow-hidden hero-gradient">
      <div class="absolute inset-0 opacity-20">
        <div class="absolute inset-0" style="background-image: radial-gradient(circle at 1px 1px, rgba(255,255,255,0.18) 1px, transparent 0); background-size: 40px 40px;"></div>
      </div>
      <div class="relative max-w-2xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="glass-card rounded-3xl p-8 md:p-10 animate-fade-in">
          <div class="text-center mb-6">
            <h2 class="text-3xl md:text-4xl font-bold mb-2" id="displayName">Loading...</h2>
            <div class="text-lg text-hackers-gold mb-2" id="hackerNumber"></div>
            <div class="text-sm text-gray-400 mb-4">Events Attended: <span id="eventsAttended">-</span> | Last Attended: <span id="lastAttended">-</span></div>
              <!-- Anniversary Badges -->
              <div class="badges flex flex-wrap justify-center gap-4 mb-4" id="anniversaryBadges"></div>
          </div>
          <div class="badges flex flex-wrap justify-center gap-2 mb-6" id="badges"></div>
          <div class="events-list mb-8">
            <h4 class="text-xl font-semibold mb-2">Years Attended</h4>
            <ul id="yearsList" class="flex flex-wrap gap-2 justify-center"></ul>
          </div>
          <div class="awards-section">
            <h4 class="text-xl font-semibold mb-4 flex items-center gap-2"><i data-lucide="award" class="w-6 h-6 text-hackers-gold"></i> Awards & Honours</h4>
            <div id="awardsList" class="flex flex-wrap gap-3 justify-center"></div>

            <!-- Detailed honours timeline (seeded from honour-roll-seeder) -->
            <div id="honoursList" class="mt-6 grid gap-3"></div>
          </div>
        </div>
      </div>
    </section>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAYat6m3-Lv46vfm6xcHLjTjRDq7NdCxAk",
      authDomain: "hackers-cup.firebaseapp.com",
      databaseURL: "https://hackers-cup-default-rtdb.firebaseio.com",
      projectId: "hackers-cup",
      storageBucket: "hackers-cup.appspot.com",
      messagingSenderId: "765736070872",
      appId: "1:765736070872:web:86a51c41916e7af75631ad",
      measurementId: "G-6E1M14F510"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();
    const database = firebase.database();

    // small helper to build badge HTML (keeps markup DRY)
    function makeBadge(label, opts = {}) {
      const type = opts.type || '';
      const icon = opts.icon || 'award';
      const cls = `badge ${type ? type : ''}`.trim();
      return `<span class="${cls}"><i data-lucide="${icon}" class="w-4 h-4"></i>${label}</span>`;
    }

    function renderBadges(totalBadges, consecutiveBadges) {
      const badgeDiv = document.getElementById('badges');
      const items = [];
      // Only show non-anniversary badges (filter out 5, 10, 15, 20, 25 year text badges)
      const filteredTotal = (totalBadges || []).filter(b => !/^\s*(5|10|15|20|25)\s*(year|years|yrs|yr)?\s*$/i.test(b));
      const filteredConsec = (consecutiveBadges || []).filter(b => !/^\s*(5|10|15|20|25)\s*(year|years|yrs|yr)?\s*$/i.test(b));
      filteredTotal.forEach(b => items.push(makeBadge(b, { type: 'total', icon: 'award' })));
      filteredConsec.forEach(b => items.push(makeBadge(b, { type: 'consec', icon: 'award' })));
      badgeDiv.innerHTML = items.length ? items.join('') : `<div class="no-data">No attendance badges yet.</div>`;
    }

    function renderYears(years) {
      const yearsList = document.getElementById('yearsList');
      if (!Array.isArray(years) || years.length === 0) {
        yearsList.innerHTML = `<li class="no-data">No events attended yet.</li>`;
        return;
      }
      yearsList.innerHTML = years.sort((a,b) => a-b).map(y => `<li class="year">HC${y}</li>`).join('');
    }

    function renderProfile(profile, displayName, hackerNumber) {
      document.getElementById('displayName').textContent = displayName || 'Hacker';
      document.getElementById('hackerNumber').textContent = hackerNumber ? `Hacker No. ${hackerNumber}` : '';
      document.getElementById('eventsAttended').textContent = profile.eventsAttended || '-';
      document.getElementById('lastAttended').textContent = profile.lastAttended ? `HC${profile.lastAttended}` : '-';

      window.profileData = profile; // Store for modal lookup
      renderAnniversaryBadges(profile.totalBadges || []);
      renderBadges(profile.totalBadges || [], profile.consecutiveBadges || []);
          // Render earned anniversary badges only, larger, clickable for modal view
          function renderAnniversaryBadges(totalBadges) {
            const badgeDiv = document.getElementById('anniversaryBadges');
            const badgeMap = {
              '5': { img: 'assets/images/5year.png', title: '5 Years' },
              '10': { img: 'assets/images/10year.png', title: '10 Years' },
              '15': { img: 'assets/images/15year.png', title: '15 Years' },
              '20': { img: 'assets/images/20year.png', title: '20 Years' },
              '25': { img: 'assets/images/25year.png', title: '25 Years' }
            };
            const earned = [];
            (totalBadges || []).forEach(b => {
              const match = (b + '').match(/^(5|10|15|20|25)\s*(year|years|yrs|yr)?$/i);
              if (match && badgeMap[match[1]]) earned.push(badgeMap[match[1]]);
            });
            if (!earned.length) { badgeDiv.innerHTML = ''; return; }
            badgeDiv.innerHTML = earned.map(b =>
              `<img src="${b.img}" alt="${b.title}" class="w-24 h-24 rounded-full shadow-xl mx-2 cursor-pointer transition-transform hover:scale-110" title="${b.title}" onclick="showBadgeModal('${b.img}','${b.title}')" />`
            ).join('');
          }

          // Modal for badge view
          window.showBadgeModal = function(img, title) {
            let modal = document.getElementById('badgeModal');
            if (!modal) {
              modal = document.createElement('div');
              modal.id = 'badgeModal';
              modal.className = 'fixed inset-0 z-[200] flex items-center justify-center bg-black bg-opacity-80';
              modal.innerHTML = `<div class="relative"><img id="badgeModalImg" src="" alt="" class="rounded-2xl shadow-2xl" style="max-width:90vw;max-height:80vh;" /><button onclick="closeBadgeModal()" class="absolute top-2 right-2 bg-white bg-opacity-80 rounded-full p-2 text-black text-xl">&times;</button><div id="badgeModalTitle" class="text-center text-white text-2xl mt-4"></div><div id="badgeModalDetails" class="text-center text-gray-200 text-lg mt-2"></div></div>`;
              document.body.appendChild(modal);
            }
            document.getElementById('badgeModalImg').src = img;
            document.getElementById('badgeModalImg').alt = title;
            document.getElementById('badgeModalTitle').textContent = title;

            // Work out achievement details
            let badgeNum = title.match(/\d+/) ? parseInt(title.match(/\d+/)[0]) : null;
            let profile = window.profileData || {};
            let years = Array.isArray(profile.attendedYears) ? profile.attendedYears.slice().sort((a,b)=>a-b) : [];
            let index = badgeNum ? (badgeNum-1) : null;
            let hcNum = years[index] || null;
            let year = hcNum ? (2000 + hcNum) : null;
            let location = '';
            if (profile.eventLocations && hcNum && profile.eventLocations[hcNum]) {
              location = profile.eventLocations[hcNum];
            } else if (profile.honours && hcNum) {
              let honour = profile.honours.find(h => h.eventId == hcNum && h.location);
              if (honour) location = honour.location;
            }
            let details = '';
            if (hcNum) details += `Hackers Cup: HC${hcNum}`;
            if (year) details += `<br>Year: ${year}`;
            if (location) details += `<br>Location: ${location}`;
            if (!details) details = '<span class="text-red-300">Could not determine achievement details.</span>';
            document.getElementById('badgeModalDetails').innerHTML = details;
            modal.style.display = 'flex';
          }
          window.closeBadgeModal = function() {
            const modal = document.getElementById('badgeModal');
            if (modal) modal.style.display = 'none';
          }
      renderYears(profile.attendedYears || []);
      renderAwards(profile);
      renderHonours(profile);

      // one icon render after DOM updates
      lucide.createIcons();
    }

    // detect attendance milestone strings or honours so we don't duplicate them
    function isAttendanceString(s) {
      if (!s) return false;
      const t = (s + '').trim();
      // explicit matches
      if (/^\d+\s*(year|years|yrs|yr)?$/i.test(t)) return true;            // "5 Year", "25 Years", "25yrs"
      if (/^\d+\s*consecutive$/i.test(t)) return true;                    // "3 Consecutive"
      if (/consec/i.test(t) && /\d+/.test(t)) return true;                 // "3 consec"
      // loose matches: contains 'year' or 'consec' and a number
      if (/[0-9]/.test(t) && (/year/i.test(t) || /yr\b/i.test(t) || /consec|consecutive/i.test(t))) return true;
      return false;
    }

    function renderAwards(profile) {
      const awardsList = document.getElementById('awardsList');
      // Only show a compact honours-summary here (attendance badges are shown at top)
      const honoursArray = Array.isArray(profile.honours) ? profile.honours.filter(h => !isAttendanceString(h.category || h.text)) : [];
      const otherAwardsArray = Array.isArray(profile.otherAwards) ? profile.otherAwards.filter(a => !isAttendanceString(a)) : [];

      // dedupe by text/category/eventId so the count is accurate
      const seen = new Set();
      const uniqHonours = [];
      honoursArray.forEach(h => {
        const key = `${h.category||''}|${h.eventId||''}|${h.text||''}`;
        if (!seen.has(key)) { seen.add(key); uniqHonours.push(h); }
      });
      otherAwardsArray.forEach(a => {
        const key = `${a}|${a}|${a}`;
        if (!seen.has(key)) { seen.add(key); uniqHonours.push({ category: a, text: a }); }
      });

      const honoursCount = uniqHonours.length;
      awardsList.innerHTML = honoursCount ? `<a href="#honoursList" class="badge badge--muted" style="text-decoration:none">Honours (${honoursCount})</a>` : `<div class="no-data">No awards recorded.</div>`;
    }

    function renderHonours(profile) {
      const honoursList = document.getElementById('honoursList');
      // combine structured honours + free-text otherAwards (exclude attendance-only entries)
      const honours = Array.isArray(profile.honours) ? profile.honours.slice() : [];
      const otherAwards = Array.isArray(profile.otherAwards) ? profile.otherAwards.slice() : [];

      // Build attendance numbers from the top badges so we can filter any honour that references them
      const attendanceNumbers = new Set();
      (profile.totalBadges || []).concat(profile.consecutiveBadges || []).forEach(b => {
        const m = (b + '').match(/(\d+)/g);
        if (m) m.forEach(n => attendanceNumbers.add(n));
      });

      // filter out attendance milestone entries to avoid duplication
      const filteredHonours = honours.filter(h => {
        const txt = (h.category || h.text || '').toString();
        if (isAttendanceString(txt)) return false;
        // if honour text contains an attendance number, exclude it
        for (const n of attendanceNumbers) {
          if (new RegExp(`\\b${n}\\b`).test(txt)) return false;
        }
        return true;
      });

      const filteredOtherAwards = otherAwards.filter(a => {
        if (isAttendanceString(a)) return false;
        for (const n of attendanceNumbers) {
          if (new RegExp(`\\b${n}\\b`).test(a)) return false;
        }
        return true;
      }).map(a => ({ category: a, text: a }));

      // merge and dedupe by category+eventId+text
      const merged = filteredHonours.concat(filteredOtherAwards);
      const seen = new Set();
      const combined = [];
      for (const h of merged) {
        const key = `${(h.category||'').toString().toLowerCase()}|${(h.eventId||'').toString().toLowerCase()}|${(h.text||'').toString().toLowerCase()}`.trim();
        if (seen.has(key)) continue;
        seen.add(key);
        combined.push(h);
      }

      if (!combined.length) {
        honoursList.innerHTML = `<p class="no-data">No honours recorded.</p>`;
        return;
      }

      combined.sort((a,b) => (b.year || 0) - (a.year || 0));
      honoursList.innerHTML = combined.map(h => {
        const year = h.year || '';
        const eventId = h.eventId || '';
        const category = h.category || h.text || 'Award';
        const location = h.location ? `<span class="meta">${h.location}</span>` : '';
        const text = h.text || category;
        return `
          <article class="honour-card">
            <div class="w-12 h-12 rounded-md bg-hackers-navy flex items-center justify-center text-hackers-gold">
              <i data-lucide="award" class="w-5 h-5"></i>
            </div>
            <div class="flex-1">
              <div class="flex items-center justify-between">
                <div class="meta">${year} â€¢ <span class="font-semibold">${eventId}</span></div>
                <div class="meta">${category}</div>
              </div>
              <div class="title">${text}</div>
              <div class="meta mt-1">${location}</div>
            </div>
          </article>
        `;
      }).join('');
    }

    firebase.auth().onAuthStateChanged(async function(user) {
      if (!user) {
        window.location.href = 'login.html';
        return;
      }
      // Fetch displayName and hackerNumber from Realtime Database
      const userRef = database.ref(`users/${user.uid}/displayName`);
      const hackerRef = database.ref(`users/${user.uid}/hackerNumber`);
      let displayName = 'Hacker';
      let hackerNumber = '';
      await userRef.once('value').then(snap => { if (snap.exists()) displayName = snap.val(); });
      await hackerRef.once('value').then(snap => { if (snap.exists()) hackerNumber = snap.val(); });
      // Listen for profile updates in Firestore so seeded honours appear immediately
      const profileRef = db.collection('attendeeProfiles').doc(displayName);
      profileRef.onSnapshot(doc => {
        if (doc.exists) {
          renderProfile(doc.data(), displayName, hackerNumber);
        } else {
          document.getElementById('displayName').textContent = displayName;
          document.getElementById('eventsAttended').textContent = '-';
          document.getElementById('lastAttended').textContent = '-';
          renderBadges([], []);
          renderYears([]);
          renderHonours({});
        }
      });
    });

    // Remove Preloader
    (function handlePreloader() {
      const preloader = document.getElementById('preloader');
      if (!preloader) return;

      const hasVisited = localStorage.getItem('hc_preloaded') === '1';
      let removed = false;

      const hidePreloader = () => {
        if (removed) return;
        removed = true;
        preloader.style.opacity = '0';
        setTimeout(() => preloader.remove(), 300);
        localStorage.setItem('hc_preloaded', '1');
      };

      if (hasVisited) {
        preloader.style.opacity = '0';
        preloader.remove();
        return;
      }

      window.addEventListener('load', hidePreloader, { once: true });
      setTimeout(hidePreloader, 3000);
    })();

    window.toggleMobileMenu = function() {
      const menu = document.getElementById('mobile-menu');
      menu.classList.toggle('hidden');
    };

    // Smooth-scroll to honours section and add temporary highlight
    function smoothScrollToHonours() {
      const el = document.getElementById('honoursList');
      if (!el) return;
      const nav = document.querySelector('nav');
      const navH = nav ? nav.offsetHeight : 80;
      const top = el.getBoundingClientRect().top + window.scrollY - navH - 16;
      window.scrollTo({ top, behavior: 'smooth' });
      el.classList.add('highlight');
      setTimeout(() => el.classList.remove('highlight'), 1400);
    }

    // Delegate clicks for any anchor that links to honoursList
    document.addEventListener('click', (e) => {
      const a = e.target.closest('a[href="#honoursList"]');
      if (a) {
        e.preventDefault();
        smoothScrollToHonours();
      }
    });

    lucide.createIcons();
  </script>
</body>
</html>
