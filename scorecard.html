<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
  <title>Player Scorecard | Hackers Cup</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
          },
          colors: {
            hackers: {
              dark: '#0f172a',
              navy: '#1e3a5f',
              sky: '#0ea5e9',
              light: '#38bdf8',
              gold: '#f59e0b',
              surface: '#1e293b',
            }
          }
        }
      }
    }
  </script>

  <style>
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    ::-webkit-scrollbar-track {
      background: #0f172a;
    }
    ::-webkit-scrollbar-thumb {
      background: #334155;
      border-radius: 4px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: #475569;
    }

    .glass {
      background: rgba(30, 41, 59, 0.7);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .glass-card {
      background: rgba(30, 41, 59, 0.6);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border: 1px solid rgba(255, 255, 255, 0.08);
    }

    .hero-gradient {
      background: linear-gradient(135deg, #0f172a 0%, #1e3a5f 50%, #0f172a 100%);
    }

    .scorecard-table {
      width: 100%;
      margin: 20px 0;
      border-collapse: collapse;
      font-family: 'Inter', sans-serif;
      color: #ffffff;
      border-radius: 18px;
      overflow: hidden;
    }

    .scorecard-table thead tr {
      background-color: rgba(30, 41, 59, 0.9);
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .scorecard-table th,
    .scorecard-table td {
      padding: 12px 14px;
      border: 1px solid rgba(148, 163, 184, 0.2);
      text-align: center;
      font-size: 14px;
    }

    .scorecard-table tbody tr:nth-child(even) {
      background-color: rgba(30, 41, 59, 0.45);
    }

    .scorecard-table tbody tr:nth-child(odd) {
      background-color: rgba(15, 23, 42, 0.6);
    }

    .scorecard-table tbody tr:hover {
      background-color: rgba(56, 189, 248, 0.2);
      cursor: pointer;
    }

    .stats-card {
      display: inline-flex;
      flex-direction: column;
      gap: 6px;
      padding: 14px 18px;
      background-color: rgba(15, 23, 42, 0.7);
      border-radius: 14px;
      color: #ffffff;
      text-align: left;
      min-width: 160px;
      border: 1px solid rgba(255, 255, 255, 0.12);
    }

    .overflow-x-auto {
      overflow-x: visible;
    }

    @media (min-width: 769px) {
      .scorecard-table {
        table-layout: fixed;
      }
      .scorecard-table th,
      .scorecard-table td {
        width: 10%;
        min-width: 60px;
        max-width: 90px;
        font-size: 14px;
        padding: 8px 10px;
        text-align: center;
      }
    }

    @media (max-width: 768px) {
      .scorecard-table {
        table-layout: fixed;
      }
      .scorecard-table th,
      .scorecard-table td {
        width: 10%;
        min-width: 36px;
        max-width: 64px;
        font-size: 12px;
        padding: 8px 8px;
      }
      .scorecard-table th:last-child,
      .scorecard-table td:last-child {
        width: 10%;
        min-width: 50px;
        max-width: 80px;
      }

      .stats-card {
        width: 100%;
        text-align: center;
        align-items: center;
      }
    }

    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(15, 23, 42, 0.95);
      backdrop-filter: blur(20px);
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      z-index: 50;
      padding-bottom: env(safe-area-inset-bottom);
    }

    @media (min-width: 768px) {
      .bottom-nav {
        display: none;
      }
    }
  </style>
<link rel="manifest" href="site.webmanifest">
</head>
<body class="bg-hackers-dark text-white font-sans antialiased pb-24">

  <nav class="fixed top-0 w-full z-40 glass border-b border-white/10">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <div class="flex-shrink-0 flex items-center gap-3">
          <div class="w-10 h-10 rounded-full flex items-center justify-center overflow-hidden bg-hackers-navy">
            <img src="assets/images/logo.png" alt="Hackers Cup Logo" class="w-8 h-8 object-contain" />
          </div>
          <span class="font-bold text-xl tracking-tight">Hackers Cup</span>
        </div>

        <div class="hidden md:flex items-center space-x-1">
          <a href="index.html" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-300 hover:text-white hover:bg-white/10 transition-colors">Home</a>
          <a href="register.html" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-300 hover:text-white hover:bg-white/10 transition-colors">Register</a>
          <a href="venue.html" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-300 hover:text-white hover:bg-white/10 transition-colors">Venue</a>
          <a href="payment.html" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-300 hover:text-white hover:bg-white/10 transition-colors">Payment</a>
          <a href="podcast.html" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-300 hover:text-white hover:bg-white/10 transition-colors">Podcast</a>
          <a href="schedule.html" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-300 hover:text-white hover:bg-white/10 transition-colors">Schedule</a>
          <a href="honour-roll.html" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-300 hover:text-white hover:bg-white/10 transition-colors">Honour Roll</a>
        <a href="notifications-center.html" class="block px-3 py-2 rounded-md text-base font-medium text-gray-300 hover:text-white hover:bg-white/10">Notifications</a>
          <a href="notifications-center.html" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-300 hover:text-white hover:bg-white/10 transition-colors">Notifications</a>
        </div>

        <div class="md:hidden">
          <button onclick="toggleMobileMenu()" class="p-2 rounded-lg text-gray-300 hover:text-white hover:bg-white/10">
            <i data-lucide="menu" class="w-6 h-6"></i>
          </button>
        </div>
      </div>
    </div>

    <div id="mobile-menu" class="hidden md:hidden glass border-t border-white/10">
      <div class="px-4 pt-2 pb-3 space-y-1">
        <a href="index.html" class="block px-3 py-2 rounded-md text-base font-medium text-gray-300 hover:text-white hover:bg-white/10">Home</a>
        <a href="register.html" class="block px-3 py-2 rounded-md text-base font-medium text-gray-300 hover:text-white hover:bg-white/10">Register</a>
        <a href="venue.html" class="block px-3 py-2 rounded-md text-base font-medium text-gray-300 hover:text-white hover:bg-white/10">Venue</a>
        <a href="payment.html" class="block px-3 py-2 rounded-md text-base font-medium text-gray-300 hover:text-white hover:bg-white/10">Payment</a>
        <a href="podcast.html" class="block px-3 py-2 rounded-md text-base font-medium text-gray-300 hover:text-white hover:bg-white/10">Podcast</a>
        <a href="schedule.html" class="block px-3 py-2 rounded-md text-base font-medium text-gray-300 hover:text-white hover:bg-white/10">Schedule</a>
        <a href="honour-roll.html" class="block px-3 py-2 rounded-md text-base font-medium text-gray-300 hover:text-white hover:bg-white/10">Honour Roll</a>
      </div>
    </div>
  </nav>

  <section class="relative pt-24 pb-12 md:pt-32 md:pb-16 overflow-hidden hero-gradient">
    <div class="absolute inset-0 opacity-20">
      <div class="absolute inset-0" style="background-image: radial-gradient(circle at 1px 1px, rgba(255,255,255,0.18) 1px, transparent 0); background-size: 40px 40px;"></div>
    </div>
    <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="space-y-4">
        <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full glass border border-hackers-sky/30">
          <i data-lucide="clipboard-list" class="w-4 h-4 text-hackers-sky"></i>
          <span class="text-sm font-medium text-gray-300">Stableford Format</span>
        </div>
        <h1 class="text-4xl md:text-5xl font-bold tracking-tight text-white leading-tight">Player Scorecard</h1>
        <p class="text-lg text-gray-300">Live hole-by-hole scoring breakdown.</p>
      </div>
    </div>
  </section>

  <section class="py-10 md:py-14 -mt-8 relative z-10">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="glass-card rounded-3xl p-6 md:p-8">
        <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
          <div>
            <h2 id="player-name" class="text-2xl font-semibold">Player Name</h2>
            <p id="player-handicap" class="text-sm text-gray-400"></p>
          </div>
          <div class="stats-card">
            <div>Score: <span id="total-points">0</span></div>
            <div>Rank: <span id="player-rank">N/A</span></div>
          </div>
        </div>

        <div class="mt-6 space-y-6">
          <div class="overflow-x-auto">
            <table id="front-nine-table" class="scorecard-table">
              <thead>
                <tr>
                  <th>1</th>
                  <th>2</th>
                  <th>3</th>
                  <th>4</th>
                  <th>5</th>
                  <th>6</th>
                  <th>7</th>
                  <th>8</th>
                  <th>9</th>
                  <th>Out</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td id="par1"></td>
                  <td id="par2"></td>
                  <td id="par3"></td>
                  <td id="par4"></td>
                  <td id="par5"></td>
                  <td id="par6"></td>
                  <td id="par7"></td>
                  <td id="par8"></td>
                  <td id="par9"></td>
                  <td id="parOut"></td>
                </tr>
                <tr>
                  <td id="score1"></td>
                  <td id="score2"></td>
                  <td id="score3"></td>
                  <td id="score4"></td>
                  <td id="score5"></td>
                  <td id="score6"></td>
                  <td id="score7"></td>
                  <td id="score8"></td>
                  <td id="score9"></td>
                  <td id="scoreOut"></td>
                </tr>
                <tr>
                  <td id="points1"></td>
                  <td id="points2"></td>
                  <td id="points3"></td>
                  <td id="points4"></td>
                  <td id="points5"></td>
                  <td id="points6"></td>
                  <td id="points7"></td>
                  <td id="points8"></td>
                  <td id="points9"></td>
                  <td id="pointsOut"></td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="overflow-x-auto">
            <table id="back-nine-table" class="scorecard-table">
              <thead>
                <tr>
                  <th>10</th>
                  <th>11</th>
                  <th>12</th>
                  <th>13</th>
                  <th>14</th>
                  <th>15</th>
                  <th>16</th>
                  <th>17</th>
                  <th>18</th>
                  <th>In</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td id="par10"></td>
                  <td id="par11"></td>
                  <td id="par12"></td>
                  <td id="par13"></td>
                  <td id="par14"></td>
                  <td id="par15"></td>
                  <td id="par16"></td>
                  <td id="par17"></td>
                  <td id="par18"></td>
                  <td id="parIn"></td>
                </tr>
                <tr>
                  <td id="score10"></td>
                  <td id="score11"></td>
                  <td id="score12"></td>
                  <td id="score13"></td>
                  <td id="score14"></td>
                  <td id="score15"></td>
                  <td id="score16"></td>
                  <td id="score17"></td>
                  <td id="score18"></td>
                  <td id="scoreIn"></td>
                </tr>
                <tr>
                  <td id="points10"></td>
                  <td id="points11"></td>
                  <td id="points12"></td>
                  <td id="points13"></td>
                  <td id="points14"></td>
                  <td id="points15"></td>
                  <td id="points16"></td>
                  <td id="points17"></td>
                  <td id="points18"></td>
                  <td id="pointsIn"></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </section>

  <div class="bottom-nav md:hidden">
    <div class="flex justify-around items-center h-16 pb-safe">
      <a href="index.html" class="flex flex-col items-center justify-center w-full h-full text-gray-400 hover:text-white">
        <i data-lucide="home" class="w-6 h-6 mb-1"></i>
        <span class="text-[10px] font-medium">Home</span>
      </a>
      <a href="payment.html" class="flex flex-col items-center justify-center w-full h-full text-gray-400 hover:text-white">
        <i data-lucide="credit-card" class="w-6 h-6 mb-1"></i>
        <span class="text-[10px] font-medium">Payment</span>
      </a>
      <a href="podcast.html" class="flex flex-col items-center justify-center w-full h-full text-gray-400 hover:text-white">
        <i data-lucide="mic" class="w-6 h-6 mb-1"></i>
        <span class="text-[10px] font-medium">Podcast</span>
      </a>
      <a href="score.html" class="flex flex-col items-center justify-center w-full h-full text-gray-400 hover:text-white">
        <i data-lucide="trending-up" class="w-6 h-6 mb-1"></i>
        <span class="text-[10px] font-medium">Score</span>
      </a>
    </div>
  </div>

  <script>
    function toggleMobileMenu() {
      const menu = document.getElementById('mobile-menu');
      menu.classList.toggle('hidden');
    }

    document.addEventListener('DOMContentLoaded', () => {
      if (window.lucide) {
        window.lucide.createIcons();
      }
    });
  </script>

  <!-- Main Script to Fetch & Populate Scorecard Data -->
  <script>
  /****************************************************
   * 1) Get the player name from the URL parameter
   ****************************************************/
  const urlParams = new URLSearchParams(window.location.search);
  const playerName = urlParams.get('player') || "Unknown Player";
  document.getElementById('player-name').textContent = playerName;

  /****************************************************
   * Hole order (exactly as requested)
   ****************************************************/
  const frontOrder = [1, 2, 3, 4, 5, 6, 7, 8, 24];              // "Out"
  const backOrder  = [25, 9, 19, 20, 21, 17, 18, 10, 27];       // "In"

  // Convenience helpers
  const setText = (id, v) => { const el = document.getElementById(id); if (el) el.textContent = v; };
  const sumByOrder = (arr, order) => order.reduce((s, h) => s + (Number(arr[h]) || 0), 0);

  /****************************************************
   * 2) Fetch the Google Sheet data for the scorecard
   *    Each row = 1 hole, with columns:
   *    E (index 4) = hole #, F (index 5) = par,
   *    I (index 8) = score, M (index 12) = points
   ****************************************************/
  const sheetId = '1DIsWVucIZPX6GhqGtMimjdMLpbWQ7-irCJs6zHBSy1I';
  const fetchUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(playerName)}`;

  // Arrays indexed by hole number (can contain 24, 25, 27, etc.)
  const holePars = [];
  const holeScores = [];
  const holePoints = [];

  fetch(fetchUrl)
    .then(response => response.text())
    .then(text => {
      const json = JSON.parse(text.match(/google\.visualization\.Query\.setResponse\((.*)\);/)[1]);
      const rows = json.table.rows;

      rows.forEach(r => {
        const holeNum  = r.c[4]  ? parseInt(r.c[4].v, 10)  : 0;  // E
        const parVal   = r.c[5]  ? parseInt(r.c[5].v, 10)  : 0;  // F
        const scoreVal = r.c[8]  ? parseInt(r.c[8].v, 10)  : 0;  // I
        const ptsVal   = r.c[12] ? parseInt(r.c[12].v, 10) : 0;  // M

        // Accept holes 1..27 (covers 24, 25, 27)
        if (holeNum >= 1 && holeNum <= 27) {
          holePars[holeNum]   = parVal;
          holeScores[holeNum] = scoreVal;
          holePoints[holeNum] = ptsVal;
        }
      });

      /****************************************************
       * Update table HEADERS to reflect custom order
       ****************************************************/
      const frontHeads = document.querySelectorAll('#front-nine-table thead th');
      for (let i = 0; i < 9; i++) frontHeads[i].textContent = frontOrder[i];
      frontHeads[9].textContent = 'Out';

      const backHeads = document.querySelectorAll('#back-nine-table thead th');
      for (let i = 0; i < 9; i++) backHeads[i].textContent = backOrder[i];
      backHeads[9].textContent = 'In';

      /****************************************************
       * Populate FRONT (positions 1..9 map to frontOrder)
       ****************************************************/
      let outParSum = 0, outScoreSum = 0, outPointsSum = 0;
      for (let i = 0; i < 9; i++) {
        const hole = frontOrder[i];
        const pos  = i + 1; // column ids 1..9
        setText(`par${pos}`,    holePars[hole]   ?? 0);
        setText(`score${pos}`,  holeScores[hole] ?? 0);
        setText(`points${pos}`, holePoints[hole] ?? 0);
      }
      outParSum    = sumByOrder(holePars,   frontOrder);
      outScoreSum  = sumByOrder(holeScores, frontOrder);
      outPointsSum = sumByOrder(holePoints, frontOrder);
      setText("parOut",    outParSum);
      setText("scoreOut",  outScoreSum);
      setText("pointsOut", outPointsSum);

      /****************************************************
       * Populate BACK (positions 10..18 map to backOrder)
       ****************************************************/
      let inParSum = 0, inScoreSum = 0, inPointsSum = 0;
      for (let i = 0; i < 9; i++) {
        const hole = backOrder[i];
        const pos  = 10 + i; // column ids 10..18
        setText(`par${pos}`,    holePars[hole]   ?? 0);
        setText(`score${pos}`,  holeScores[hole] ?? 0);
        setText(`points${pos}`, holePoints[hole] ?? 0);
      }
      inParSum    = sumByOrder(holePars,   backOrder);
      inScoreSum  = sumByOrder(holeScores, backOrder);
      inPointsSum = sumByOrder(holePoints, backOrder);
      setText("parIn",    inParSum);
      setText("scoreIn",  inScoreSum);
      setText("pointsIn", inPointsSum);

      // After you compute outPointsSum and inPointsSum:
const totalPts = outPointsSum + inPointsSum;
document.getElementById("total-points").textContent = totalPts;


      /****************************************************
       * 3) Color-code the SCORE cells by difference (Score - Par)
       *    We color by POSITION (cell id) using the mapped hole.
       ****************************************************/
      function colorScoreCellFor(holeNumber, cellId) {
        const par = holePars[holeNumber] || 0;
        const scr = holeScores[holeNumber] || 0;
        const diff = scr - par;
        const cell = document.getElementById(cellId);
        if (!cell) return;

        // Reset any previous styling
        cell.style.backgroundColor = "";
        cell.style.color = "";

        if (diff === 0) {
          cell.style.backgroundColor = "white";
          cell.style.color = "black";
        } else if (diff === -1) {
          cell.style.backgroundColor = "#add8e6"; // Light blue
          cell.style.color = "black";
        } else if (diff === -2) {
          cell.style.backgroundColor = "blue";
          cell.style.color = "white";
        } else if (diff === -3) {
          cell.style.backgroundColor = "navy";
          cell.style.color = "white";
        } else if (diff === 1) {
          cell.style.backgroundColor = "orange";
          cell.style.color = "black";
        } else if (diff >= 2) {
          cell.style.backgroundColor = "red";
          cell.style.color = "white";
        }
      }

      // Apply colors for front positions 1..9
      for (let i = 0; i < 9; i++) {
        colorScoreCellFor(frontOrder[i], `score${i + 1}`);
      }
      // Apply colors for back positions 10..18
      for (let i = 0; i < 9; i++) {
        colorScoreCellFor(backOrder[i], `score${10 + i}`);
      }
    })
    .catch(err => console.error("Error fetching or parsing scorecard data:", err));

  /****************************************************
   * 4) Leaderboard rank & total points (unchanged)
   ****************************************************/
  
// 4) Leaderboard rank ONLY (don’t overwrite total-points)

// 4) Leaderboard RANK — compute from Points so it's always correct

// 4) Leaderboard RANK — compute from Points, match player by col B or C
const leaderboardSheetId = '1DIsWVucIZPX6GhqGtMimjdMLpbWQ7-irCJs6zHBSy1I'; // same doc as scorecard
const leaderboardGid = '1551828927'; // your leaderboard tab
const leaderboardUrl = `https://docs.google.com/spreadsheets/d/${leaderboardSheetId}/gviz/tq?tqx=out:json&gid=${leaderboardGid}`;

fetch(leaderboardUrl)
  .then(r => r.text())
  .then(text => {
    const json = JSON.parse(text.match(/google\.visualization\.Query\.setResponse\((.*)\);/)[1]);
    const cols = (json.table.cols || []).map(c => (c && c.label ? c.label.toString().trim().toLowerCase() : ''));
    const rows = json.table.rows || [];

    // Explicit column assumptions per your note:
    // B = index 1 (a.k.a. c[1])  -> nameB
    // C = index 2 (a.k.a. c[2])  -> nameC
    // Points likely in D = index 3, but detect by header if possible
    const NAME_B_COL = 1;
    const NAME_C_COL = 2;
    const pointsIdxByLabel = cols.findIndex(l => ['points','total points','score','total'].includes(l));
    const POINTS_COL = pointsIdxByLabel >= 0 ? pointsIdxByLabel : 3; // fallback to D

    const getV  = c => (c ? (c.v ?? c.f ?? '') : '');
    const norm  = s => String(s ?? '').trim().toLowerCase();
    const toNum = v => {
      if (typeof v === 'number') return v;
      const n = parseFloat(String(v).replace(/[^\d.-]/g,''));
      return Number.isFinite(n) ? n : 0;
    };

    const target = norm(playerName);

    // Build entries {nameB, nameC, points}
    const entries = rows.map(r => ({
      nameB: norm(getV(r.c[NAME_B_COL])),
      nameC: norm(getV(r.c[NAME_C_COL])),
      points: toNum(getV(r.c[POINTS_COL]))
    }));

    // Sort by points desc
    entries.sort((a, b) => b.points - a.points);

    // Standard competition ranking (ties share rank)
    let rank = 'N/A';
    for (let i = 0; i < entries.length; ) {
      const start = i;
      const pts = entries[i].points;
      while (i < entries.length && entries[i].points === pts) i++;
      const group = entries.slice(start, i);
      // match either B OR C name to the playerName
      if (group.some(g => g.nameB === target || g.nameC === target)) {
        rank = start + 1; // 1-based rank
        break;
      }
    }

    document.getElementById('player-rank').textContent = rank;
    // Do NOT touch #total-points here — it’s set from the scorecard calc.
  })
  .catch(err => console.error('Error computing rank from leaderboard:', err));




  /****************************************************
   * 5) Handicap (unchanged)
   ****************************************************/
  const handicapSheetName = 'Handicaps';
  const handicapUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(handicapSheetName)}`;

  fetch(handicapUrl)
    .then(response => response.text())
    .then(text => {
      const json = JSON.parse(text.match(/google\.visualization\.Query\.setResponse\((.*)\);/)[1]);
      const rows = json.table.rows;
      let handicap = "N/A";
      rows.forEach(r => {
        if (r.c[0] && r.c[0].v.trim().toLowerCase() === playerName.trim().toLowerCase()) {
          handicap = r.c[1] ? r.c[1].v : "N/A";
        }
      });
      document.getElementById("player-handicap").textContent = `Handicap: ${handicap}`;
    })
    .catch(err => console.error("Error fetching handicap data:", err));

    
</script>
</body>
</html>
